<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>食材ストック計算</title>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GNGLETKNNR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GNGLETKNNR');
  </script>

  <link rel="apple-touch-icon" sizes="180x180" href="images/アイコン.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/アイコン.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/アイコン.png">
  <link rel="manifest" href="manifest.webmanifest">

  <meta name="theme-color" content="#007bff">
  <meta name="background-color" content="#f5f8fa">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="食材ストック">

  <style>
    :root {
      --bg: #f5f8fa;
      --card: #ffffff;
      --main: #007bff;
      --main-soft: #eaf4ff;
      --text: #2c3e50;
      --muted: #5d6d7e;
      --line: #d6e0ea;
      --danger: #e74c3c;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    header {
      padding: 10px 20px;
      background: var(--main);
      color: #fff;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .title-text { font-weight: 800; letter-spacing: 0.03em; font-size: 18px; }
    .ver-text { font-size: 11px; font-weight: 400; opacity: 0.8; margin-top: 2px; }

    main {
      max-width: 980px;
      margin: 0 auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding-bottom: 100px;
    }

    .tab-content { display: none; }
    .tab-content.active {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 65px;
      background: #fff;
      border-top: 1px solid var(--line);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
      padding-bottom: env(safe-area-inset-bottom);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: var(--muted);
      font-size: 10px;
      font-weight: 700;
      cursor: pointer;
      flex: 1;
      padding: 8px 0;
    }
    .nav-item.active { color: var(--main); }
    .nav-icon { font-size: 20px; }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.02);
    }

    .result-card {
      border: 2px solid var(--main);
      background: #ffffff;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 4px 20px rgba(0,123,255,0.1);
    }

    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .grid5 {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
      gap: 8px;
      width: 100%;
    }

    label { font-size: 11px; font-weight: 700; color: var(--muted); display: block; margin-bottom: 4px; }

    select, input[type="number"] {
      padding: 10px;
      border: 1px solid var(--line);
      border-radius: 10px;
      font-size: 14px;
      width: 100%;
      background: #fff;
      color: var(--text);
    }

    button {
      padding: 10px 16px;
      border: 1px solid var(--line);
      border-radius: 10px;
      font-weight: 800;
      cursor: pointer;
      font-size: 14px;
    }
    button.primary { background: var(--main); color: #fff; border-color: var(--main); }
    button.danger { color: var(--danger); border-color: #fadbd8; background: #fff; }

    .badge { font-size: 12px; padding: 4px 12px; border-radius: 999px; border: 1px solid var(--line); font-weight: 700; }
    #summaryBadge { background: var(--main-soft); color: var(--main); border: 1px solid #cce5ff; }
    .total-badge { background: var(--main); color: #fff; border: none; padding: 4px 16px; }

    .tile {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 6px 3px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      background: #fff;
      align-items: center;
      text-align: center;
      min-height: 95px;
      justify-content: space-between;
    }
    .icon { width: 30px; height: 30px; object-fit: contain; }
    .tileName { font-size: 8px; font-weight: 700; width: 100%; overflow: hidden; text-overflow: clip; white-space: nowrap; }

    .chkLabel {
      font-size: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 3px;
      width: 100%;
      height: 24px;
      margin: 0;
      padding: 0 4px;
    }
    .exChk {
      margin: 0;
      cursor: pointer;
      width: 13px;
      height: 13px;
    }

    .repInputRow {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
      width: 100%;
      padding: 0 4px;
    }
    .repQty {
      width: 100% !important;
      height: 24px !important;
      padding: 0 2px !important;
      font-size: 14px !important;
      font-weight: 800 !important;
      text-align: center;
      border-radius: 6px !important;
    }

    .recipeRow {
      border: 1px solid var(--line);
      background: #fcfdfe;
      border-radius: 16px;
      padding: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: flex-end;
      margin-bottom: 12px;
      position: relative;
    }
    .removeBtn {
      position: absolute;
      top: -8px;
      right: -8px;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--danger);
      width: 26px;
      height: 26px;
      padding: 0;
      line-height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
    }

    .preview { font-size: 12px; display: flex; flex-wrap: wrap; gap: 4px; margin-top: 10px; border-top: 1px solid var(--line); padding-top: 10px; width: 100%; align-items: center; }
    .preview span { display: flex; align-items: center; background: var(--main-soft); color: var(--main); padding: 2px 6px; border-radius: 6px; font-weight: 700; border: 1px solid #d0e7ff; }

    /* ============================ 修正箇所：画像のはみ出し防止 ============================ */
    .result-left img {
      max-width: 40px;
      height: auto;
      object-fit: contain;
    }

    /* ============================ スマホ：2列レイアウト調整 ============================ */
    @media (max-width: 520px) {
      .settingsHeaderRow {
        display: grid;
        grid-template-columns: 120px 1fr;
        grid-template-areas: "cond mode" "actions mode";
        gap: 12px;
        align-items: start;
      }
      .sectionTitle {
        font-weight: 900;
        font-size: 14px;
        border-left: 5px solid var(--main);
        padding-left: 10px;
        color: var(--text);
        margin-bottom: 6px;
      }
      #condBlock { grid-area: cond; }
      #modeBlock { 
        grid-area: mode; 
        padding-left: 10px; /* 左側に寄りすぎないよう調整 */
      }
      #actionBlock {
        grid-area: actions;
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 120px;
      }
      /* 修正：ボタンのサイズをコンパクトに */
      #actionBlock > button.primary, #actionBlock > button.danger {
        width: 100px !important; /* 横幅を制限 */
        height: 32px !important;
        padding: 0 !important;
        font-size: 12px !important;
        line-height: 32px !important;
        border-radius: 999px !important;
        margin-left: 0 !important;
      }
      
      /* モード選択のラベル配置調整 */
      .modeLabel {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 13px;
      }
    }

    /* その他既存スタイル（カレンダー、フィールド等）はそのまま維持 */
    .calendar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
    /* ... (中略：既存のカレンダースタイル) ... */
  </style>
</head>
<body>

<header>
  <div>
    <div class="title-text" id="headerTitle">食材ストック計算</div>
    <div class="ver-text">ver 2.3.0</div>
  </div>
</header>

<main>
  <div id="tab1" class="tab-content active">
    
    <div class="card">
      <div class="settingsHeaderRow">
        <div id="condBlock">
          <div class="sectionTitle">条件設定</div>
          <div id="summaryBadge" class="badge">0食 / 21食</div>
        </div>

        <div id="modeBlock">
          <div class="modeInner">
            <div class="modeTitle" style="font-weight:900; font-size:14px; color:var(--muted); margin-bottom:8px;">モードを選択してください</div>
            <label class="modeLabel"><input type="radio" name="calcMode" value="mode1" id="calcMode1"> 同じ料理 21食</label>
            <label class="modeLabel"><input type="radio" name="calcMode" value="mode2" id="calcMode2"> 料理を組み合わせる</label>
            <label class="modeLabel"><input type="radio" name="calcMode" value="mode3" id="calcMode3"> 3カテゴリ 63食</label>
          </div>
        </div>

        <div id="actionBlock">
          <button id="calculateBtn" class="primary" onclick="calc()">計算実行</button>
          <button id="resetBtn" class="danger" onclick="resetAll()">リセット</button>
        </div>
      </div>
    </div>

    <div id="recipeList"></div>
    
    <button id="addRecipe" class="primary" style="width:100%; margin-top:-4px;" onclick="addRecipeRow()">+ 料理を追加</button>

    <div id="resultArea" class="result-card" style="display:none;">
      <div id="resultRecipes"></div> <p id="resultNotice" style="font-size: 11px; color: var(--muted); margin: 16px 0; border-top: 1px solid var(--line); padding-top: 12px; line-height: 1.6;">
        ※異なるカテゴリーのレシピ間で重複している食材は、各レシピ中で最も多く使われている食材の個数を参照して計算しています
      </p>
      
      <div id="resultTotal"></div> </div>

    <div class="card">
      <div class="sectionTitle">除外設定</div>
      <div id="excludeGrid" class="grid5"></div>
    </div>
    <div class="card">
      <div class="sectionTitle">1日の獲得量 (NCピカ)</div>
      <div id="replenishGrid" class="grid5"></div>
    </div>
  </div>


  
  </main>
<nav class="bottom-nav">
  <div class="nav-item active" onclick="switchTab('tab1', this)">
    <span class="nav-icon">🔍</span>
    <span>食材ストック計算</span>
  </div>
  <div class="nav-item" onclick="switchTab('tab2', this)">
    <span class="nav-icon">🐾</span>
    <span>出現ポケモン一覧</span>
  </div>
  <div class="nav-item" onclick="switchTab('tab3', this)">
    <span class="nav-icon">📅</span>
    <span>月齢カレンダー</span>
  </div>
</nav>

<!-- お役立ち資料集モーダル -->
<div id="docsModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; align-items:center; justify-content:center; padding:20px;">
  <div class="card" style="max-width:520px; width:100%; position:relative;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; border-bottom:1px solid var(--line); padding-bottom:8px; margin-bottom:12px;">
      <div style="font-weight:900;">📚 お役立ち資料集</div>
      <button id="closeDocs" style="background:none; border:1px solid var(--line); border-radius:10px; padding:6px 10px; font-weight:800; cursor:pointer;">閉じる</button>
    </div>

<!-- お役立ち資料：画像ビューア（アプリ内） -->
<div id="docViewerModal"
  style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
         background:rgba(0,0,0,0.7); z-index:3000; align-items:center; justify-content:center; padding:14px;">
  <div class="card" style="max-width:900px; width:100%; max-height:92vh; overflow:auto; position:relative;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; border-bottom:1px solid var(--line); padding-bottom:8px; margin-bottom:12px;">
      <div id="docViewerTitle" style="font-weight:900;">資料</div>
      <button id="closeDocViewer"
        style="background:none; border:1px solid var(--line); border-radius:10px; padding:6px 10px; font-weight:800; cursor:pointer;">
        戻る
      </button>
    </div>

    <img id="docViewerImg" src="" alt=""
      style="width:100%; height:auto; border-radius:12px; border:1px solid var(--line); background:#fff;">
  </div>
</div>

    <div style="display:flex; flex-direction:column; gap:12px;">
      <div style="border:1px solid var(--line); border-radius:14px; padding:12px;">
        <div style="font-weight:900; margin-bottom:8px;">エナジー効率の良いレシピ一覧</div>
        <div class="row">
          <button class="primary" type="button" onclick="openDoc('エナジー効率の良いレシピ一覧.png')">開く</button>
          <a href="images/エナジー効率の良いレシピ一覧.png" download style="text-decoration:none;">
            <button type="button">保存</button>
          </a>
        </div>
      </div>

      <div style="border:1px solid var(--line); border-radius:14px; padding:12px;">
        <div style="font-weight:900; margin-bottom:8px;">きのみタイプ強さランキング</div>
        <div class="row">
          <button class="primary" type="button" onclick="openDoc('きのみタイプ強さランキング.png')">開く</button>
          <a href="images/きのみタイプ強さランキング.png" download style="text-decoration:none;">
            <button type="button">保存</button>
          </a>
        </div>
      </div>

      <div style="border:1px solid var(--line); border-radius:14px; padding:12px;">
        <div style="font-weight:900; margin-bottom:8px;">お香で呼べるポケモンかけらランキング</div>
        <div class="row">
          <button class="primary" type="button" onclick="openDoc('お香で呼べるポケモンかけらランキング.png')">開く</button>
          <a href="images/お香で呼べるポケモンかけらランキング.png" download style="text-decoration:none;">
            <button type="button">保存</button>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="noticeModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; align-items:center; justify-content:center; padding:20px;">
  <div class="card" style="max-width:400px; width:100%; position:relative;">

    <div style="font-weight:900; margin-bottom:12px; border-bottom:1px solid var(--line); padding-bottom:8px;">
      ご利用上の注意
    </div>

    <p style="font-size:13px; color:var(--text); line-height:1.6; margin-bottom:14px;">
      このアプリは非公式であり、
      <strong>ﾈﾃﾙ.exe（@suiminloop.bsky.social）</strong>が個人で作ったものです。<br>
      ご利用いただく際は自己責任でお願いします🙇
    </p>

    <div style="font-size:13px; color:var(--text); line-height:1.6; margin-bottom:20px;">
      <div style="font-weight:900; margin-bottom:6px;">出典：</div>
      <ul style="margin:0 0 0 18px; padding:0;">
        <li>Pokémon Sleep 公式サイト</li>
        <li>RaenonXポケスリ攻略ツール</li>
        <li>ポケモンスリープ攻略・検証 Wiki*</li>
      </ul>
    </div>

    <button id="closeNotice" class="primary" style="width:100%;">閉じる</button>
  </div>
</div>

<script>
(function(){
  function box(){
    let b=document.getElementById("bootDiag");
    if(!b){
      b=document.createElement("div");
      b.id="bootDiag";
      b.style.cssText="position:fixed;left:10px;right:10px;bottom:70px;z-index:99999;background:#fff;border:2px solid #d00;border-radius:12px;padding:10px;font-size:12px;white-space:pre-wrap;display:none";
      document.addEventListener("DOMContentLoaded",()=>document.body.appendChild(b));
    }
    return b;
  }
  function show(t){const b=box(); b.textContent=t; b.style.display="block";}
  window.addEventListener("error",e=>show("[JS Error]\n"+(e.message||"")+"\n"+(e.filename||"")+":"+e.lineno+":"+e.colno));
  window.addEventListener("unhandledrejection",e=>show("[Promise Rejection]\n"+(e.reason&& (e.reason.stack||e.reason.message))||String(e.reason)));
  window.__BOOT_DIAG__ = "OK";
})();
</script>

<script src="data/ingredients.js"></script>
<script src="data/recipes.js"></script>
<script src="data/fields.js"></script>

<script src="js/calendar.js"></script>
<script src="js/pokedex.js"></script>
<script src="js/app.js"></script>
</body>
</html>
